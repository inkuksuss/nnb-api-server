<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.smartFarm.was.web.repository.BoardRepository">

    <select id="getNoticeBoards" resultType="com.smartFarm.was.domain.response.board.BoardResponse">
        SELECT
            board_id,
            board_title,
            board_content,
            board_status,
            board_last_updated,
            board_view,
            board.member_id,
            member_name
        FROM board
                 INNER JOIN member
                        ON board.member_id = member.member_id
        WHERE category_id = 1
        AND board.state_del = 'N'
        ORDER BY board_last_updated ASC
    </select>

    <select id="getFAQBoards" resultType="com.smartFarm.was.domain.response.board.BoardResponse">
        SELECT
            board_id,
            board_title,
            board_content,
            board_status,
            board_last_updated,
            board_view,
            board.member_id,
            member_name
        FROM board
                 INNER JOIN member
                            ON board.member_id = member.member_id
        WHERE category_id = 2
        AND board.state_del = 'N'
        ORDER BY board_created DESC
    </select>

    <insert id="addBoard" parameterType="com.smartFarm.was.domain.dto.board.AddBoardDto" useGeneratedKeys="true" keyProperty="boardId">
        INSERT INTO board
            (
             member_id,
             category_id,
             board_title,
             board_content,
             board_created,
             board_view,
             board_status,
             state_del
            ) VALUES (
                      #{memberId},
                      #{categoryId},
                      #{boardTitle},
                      #{boardContent},
                      #{boardCreated},
                      #{boardView},
                      #{boardStatus},
                      #{stateDel}
                    )
    </insert>

    <resultMap id="BoardDetailMap" type="com.smartFarm.was.domain.dto.board.BoardDto">
        <id property="boardId" column="board_id" />
        <result property="memberId" column="member_id" />
        <result property="memberName" column="member_name" />
        <result property="boardTitle" column="board_title" />
        <result property="boardContent" column="board_content" />
        <result property="boardStatus" column="board_status" />
        <result property="boardView" column="board_view" />
        <result property="stateDel" column="state_del" />
        <result property="categoryValue" column="category_value" />
        <result property="boardCreated" column="board_created" />
        <result property="boardLastUpdated" column="board_last_updated" />
        <collection property="commentDtoList" resultMap="CommentsMap" notNullColumn="comment_id" />
    </resultMap>

    <resultMap id="CommentsMap" type="com.smartFarm.was.domain.dto.comment.CommentDto" >
        <id property="commentId" column="comment_id" />
        <result property="memberId" column="member_id" />
        <result property="memberName" column="member_name" />
        <result property="commentStatus" column="comment_status" />
        <result property="commentContent" column="comment_content" />
        <result property="commentCreated" column="comment_created" />
    </resultMap>

    <select id="getBoard" parameterType="long" resultMap="BoardDetailMap">
        SELECT
               board.board_id,
               board.member_id,
               board_title,
               board_content,
               board_created,
               board_last_updated,
               board_status,
               board_view,
               board.state_del,
               category_value,
               comment.comment_id,
               comment.member_id,
               member.member_name,
               comment.comment_content,
               comment.comment_created,
               comment.comment_status
        FROM board
                 LEFT JOIN category
                           ON board.category_id = category.category_id
                 LEFT JOIN member
                           ON board.member_id = member.member_id
                 LEFT JOIN comment
                           ON board.board_id = comment.board_id
        WHERE board.board_id = #{boardId}
    </select>

    <update id="deleteBoard" parameterType="com.smartFarm.was.domain.dto.board.DeleteBoardDto">
        UPDATE
            board
        SET
            board_last_updated = #{boardLastUpdated},
            state_del = #{stateDel}
        WHERE
            board_id = #{boardId} AND member_id = #{memberId}
        AND state_del = 'N'
    </update>

    <update id="updateBoard" parameterType="com.smartFarm.was.domain.request.board.UpdateBoardForm">
        UPDATE
            board
        SET
            category_id = #{categoryId},
            board_title = #{boardTitle},
            board_content = #{boardContent},
            board_status = #{boardStatus},
            board_last_updated = #{boardLastUpdated}
        WHERE
            board_id = #{boardId} AND member_id = #{memberId}
        AND state_del = 'N'
    </update>
</mapper>